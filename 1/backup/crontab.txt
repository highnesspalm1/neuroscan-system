# NeuroScan Crontab Configuration
# Add these entries to your system crontab for automated maintenance
# To install: crontab < crontab.txt

# Environment variables
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
NEUROSCAN_HOME=/opt/neuroscan
MAILTO=admin@neuroscan.com

# Daily database backup at 2:00 AM
0 2 * * * cd $NEUROSCAN_HOME && docker-compose exec -T postgres /backup.sh

# Weekly system monitoring and cleanup on Sundays at 3:00 AM
0 3 * * 0 cd $NEUROSCAN_HOME && ./scripts/monitor.sh > /var/log/neuroscan-weekly-monitor.log 2>&1

# Daily monitoring at 6:00 AM and 6:00 PM
0 6,18 * * * cd $NEUROSCAN_HOME && ./scripts/monitor.sh monitor > /var/log/neuroscan-monitor.log 2>&1

# Monthly log rotation on the 1st of each month at 1:00 AM
0 1 1 * * cd $NEUROSCAN_HOME && docker-compose exec -T backend find /app/logs -name "*.log" -mtime +30 -delete

# Docker system cleanup every Sunday at 4:00 AM
0 4 * * 0 cd $NEUROSCAN_HOME && docker system prune -f > /var/log/neuroscan-cleanup.log 2>&1

# Check SSL certificate expiration daily at 5:00 AM
0 5 * * * cd $NEUROSCAN_HOME && openssl x509 -checkend 2592000 -noout -in nginx/ssl/nginx.crt || echo "SSL certificate expires within 30 days" | mail -s "NeuroScan SSL Warning" admin@neuroscan.com

# Health check every 5 minutes (adjust frequency as needed)
*/5 * * * * cd $NEUROSCAN_HOME && curl -f http://localhost/health > /dev/null 2>&1 || echo "NeuroScan health check failed at $(date)" >> /var/log/neuroscan-health.log

# Update containers monthly on the 1st at 2:00 AM (uncomment for auto-updates)
# 0 2 1 * * cd $NEUROSCAN_HOME && docker-compose pull && docker-compose up -d --force-recreate

# Backup old logs monthly
0 1 1 * * cd $NEUROSCAN_HOME && find /var/log -name "neuroscan-*.log" -mtime +30 -exec gzip {} \;
